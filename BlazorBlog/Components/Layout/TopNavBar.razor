@using Category = BlazorBlog.Domain.Entities.Category
<!--------------------------------------
NAVBAR
--------------------------------------->
@inject ICategoryService CategoryService

<header class="sticky top-0 z-50 border-b border-slate-200/70 bg-white/80 backdrop-blur dark:border-slate-800 dark:bg-slate-950/70">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex h-16 items-center justify-between">
            <a href="/" class="group inline-flex items-center gap-2 font-semibold tracking-tight">
                <span class="inline-grid h-8 w-8 place-items-center rounded-xl bg-gradient-to-tr from-brand-600 to-accent-500 text-white shadow-soft">BB</span>
                <span class="text-lg">Blazor<span class="text-brand-600">Blog</span></span>
            </a>

            <nav class="hidden items-center gap-6 text-sm font-medium sm:flex">
                <a class="hover:text-brand-600" href="/">Home</a>
                <a class="hover:text-brand-600" href="/posts">All Posts</a>
                @foreach (var category in this.categories)
                {
                        <a class="hover:text-brand-600" href="/@category.Slug-posts" title="@category.Name Posts">@category.Name</a>
                }
            </nav>

            <div class="flex items-center gap-2">
                <AuthorizeView>
                    <Authorized>
                        <a href="admin/dashboard" class="inline-flex items-center rounded-md bg-slate-700 px-3 py-1.5 text-sm font-medium text-white hover:bg-slate-800" aria-label="Dashboard">
                            <svg class="h-5 w-5 md:hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" xmlns="http://www.w3.org/2000/svg"><path d="M3 3h7v7H3V3zM14 3h7v7h-7V3zM3 14h7v7H3v-7zM14 14h7v7h-7v-7z"/></svg>
                            <span class="hidden md:inline ml-2">Dashboard</span>
                        </a>
                        <LogoutForm ButtonClasses="inline-flex items-center rounded-md bg-red-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-red-700" />
                    </Authorized>
                    <NotAuthorized>
                        <a href="/Account/Login" class="inline-flex items-center rounded-md bg-brand-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-brand-700">Login</a>
                    </NotAuthorized>
                </AuthorizeView>
                <button data-theme-toggle class="inline-flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white/70 text-slate-600 transition hover:border-slate-300 hover:text-brand-600 dark:border-slate-800 dark:bg-slate-900/70 dark:text-slate-300" aria-label="Toggle theme">
                    <svg class="h-5 w-5 block dark:hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364-.707-.707M6.343 6.343l-.707-.707m12.728 0-.707.707M6.343 17.657l-.707.707"/><circle cx="12" cy="12" r="4"/></svg>
                    <svg class="hidden h-5 w-5 dark:block" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
                </button>
                <button id="menuBtn" class="sm:hidden inline-flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white/70 text-slate-600 transition hover:border-slate-300 hover:text-brand-600 dark:border-slate-800 dark:bg-slate-900/70 dark:text-slate-300" aria-label="Menu">
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
                </button>
            </div>
        </div>

        <div id="mobileNav" class="hidden border-t border-slate-200 py-3 dark:border-slate-800 sm:hidden">
            <nav class="grid gap-2 text-sm">
                <a class="rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900" href="/">Home</a>
                <a class="rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900" href="/posts">All Posts</a>
                @foreach (var category in this.categories)
                {
                        <a class="rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900" href="/@category.Slug-posts" title="@category.Name Posts">@category.Name</a>
                }
                <AuthorizeView>
                        <Authorized>
                                <div class="rounded-lg px-3 py-2 text-sm font-medium">@context.User.GetUserName()</div>
                                <div class="px-3"><LogoutForm ButtonClasses="rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900" /></div>
                        </Authorized>
            <NotAuthorized>
                <a class="rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900" href="/Account/Login">Login</a>
            </NotAuthorized>
                </AuthorizeView>
            </nav>
        </div>
    </div>
</header>
<!-- End Navbar -->
@code {
    private Category[] categories = [];
    private const int MaxCategoryToShow = 5;

    protected override async Task OnInitializedAsync()
    {
        var allCategories = await CategoryService.GetCategoriesAsync();

        this.categories = allCategories
            .Where(c => c.ShowOnNavBar)
            .Take(MaxCategoryToShow)
            .ToArray();

        if (this.categories.Length < MaxCategoryToShow)
        {
            this.categories =
            [
                ..this.categories, 
                ..allCategories
                    .Where(c => !c.ShowOnNavBar)
                    .Take(MaxCategoryToShow - this.categories.Length)
            ];
        }
    }
}
