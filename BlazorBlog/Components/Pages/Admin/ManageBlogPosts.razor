@page "/admin/manage-blog-posts"

@attribute [Authorize(Roles = "Admin")]

@rendermode InteractiveServer

<PageTitle>@Utils.GetPageTitle("Manage Blog Posts")</PageTitle>

<AdminHeader Title="Manage Blog Posts">
    <ActionButtons>
    <a href="admin/manage-blog-posts/new" class="inline-flex items-center rounded-md bg-brand-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-brand-700" data-enhance-nav="false">+ Add new Blog Post</a>
    </ActionButtons>
</AdminHeader>

<ConfirmationModal Title="Confirm Delete"
                   Message="Are you sure you want to delete this blog post?"
                   IsVisible="@_showConfirmationModal"
                   ConfirmationChanged="OnModalConfirm" />


@if (_showLoader)
{
    <Loader LoaderText="@_loadingText" />
}

<div class="overflow-hidden rounded-xl border border-slate-200/60 bg-white shadow-soft dark:border-slate-800 dark:bg-slate-900">
<QuickGrid @ref="_grid" ItemsProvider="_blogPostProvider" TItem="BlazorBlog.Domain.Entities.BlogPost" Pagination="_paginationState" class="w-full text-left text-sm divide-y divide-slate-200 dark:divide-slate-800 [&_thead_th]:bg-slate-50 dark:[&_thead_th]:bg-slate-800 [&_thead_th]:text-slate-700 dark:[&_thead_th]:text-slate-200 [&_th]:px-3 [&_td]:px-3 [&_th]:py-2 [&_td]:py-2 [&_tbody_tr:nth-child(odd)]:bg-slate-50 dark:[&_tbody_tr:nth-child(odd)]:bg-slate-800/40">
    <PropertyColumn Property="@(b => b.Id)" Align="Align.Center" />
    <TemplateColumn Title="Blog post" Align="Align.Center">
        <div class="grid grid-cols-[64px_auto] items-center gap-3 py-2">
            <img src="@context.Image" class="h-16 w-16 rounded object-cover" alt="@context.Title" />
            <div class="min-w-0">
                <div class="truncate text-slate-800 dark:text-slate-100 font-medium">@context.Title</div>
                @if (context.IsPublished && !string.IsNullOrWhiteSpace(context.Slug))
                {
                    <a href="/posts/@context.Slug" target="_blank" class="text-xs text-brand-600 hover:underline">@context.Slug</a>
                }
                else
                {
                    <div class="text-xs text-slate-400">@context.Slug</div>
                }
            </div>
        </div>
    </TemplateColumn>
    <TemplateColumn Title="Category" Align="Align.Center">
        @GetCategoryName(context.CategoryId)
    </TemplateColumn>
    <TemplateColumn Title="Featured" Align="Align.Center">
        <label class="inline-flex cursor-pointer items-center">
            <input type="checkbox" @bind="context.IsFeatured" @bind:after="(() => HandleFeaturedChanged(context))" class="peer sr-only" />
            <span class="relative h-5 w-9 rounded-full bg-slate-300 transition-colors peer-checked:bg-emerald-600">
                <span class="absolute left-0.5 top-0.5 h-4 w-4 rounded-full bg-white shadow transition-transform peer-checked:translate-x-4"></span>
            </span>
        </label>
    </TemplateColumn>
    <TemplateColumn Title="Published" Align="Align.Center">
        <label class="inline-flex cursor-pointer items-center">
            <input type="checkbox" @bind="context.IsPublished" @bind:after="(() => HandlePublishedChanged(context))" class="peer sr-only" />
            <span class="relative h-5 w-9 rounded-full bg-slate-300 transition-colors peer-checked:bg-emerald-600">
                <span class="absolute left-0.5 top-0.5 h-4 w-4 rounded-full bg-white shadow transition-transform peer-checked:translate-x-4"></span>
            </span>
        </label>
    </TemplateColumn>
    <TemplateColumn Title="Actions" Align="Align.Center">
        <a href="admin/manage-blog-posts/edit/@context.Id" data-enhance-nav="false" class="mr-2 inline-flex items-center rounded-md bg-brand-600 px-3 py-1 text-xs font-medium text-white hover:bg-brand-700" style="width: 80px;">Edit</a>
        <button class="inline-flex items-center rounded-md bg-red-600 px-3 py-1 text-xs font-medium text-white hover:bg-red-700" style="width: 80px;" @onclick="() => ConfirmDeleteBlogPost(context)">Delete</button>
    </TemplateColumn>
</QuickGrid>
</div>
<div class="mt-4">
    <Paginator State="_paginationState" />
</div>
