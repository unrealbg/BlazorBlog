@page "/admin/dashboard"

<PageTitle>@Utils.GetPageTitle("Dashboard")</PageTitle>

@attribute [Authorize(Roles = "Admin")]
@rendermode InteractiveServer

@inject ICategoryService CategoryService
@inject IBlogPostAdminService BlogPostAdminService
@inject ISubscribeService SubscriberService

<AdminHeader Title="Dashboard" />

<div class="space-y-6">
    <AuthorizeView>
        <Authorized>
            <div class="rounded-xl border border-slate-200/60 bg-white p-5 shadow-soft dark:border-slate-800 dark:bg-slate-900">
                <div class="flex items-start justify-between gap-4">
                    <div>
                        <h2 class="text-base font-semibold text-slate-900 dark:text-slate-100">Welcome, @context.User.GetUserName()</h2>
                        <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">You are logged in as an administrator.</p>
                    </div>
                    <span class="inline-flex items-center rounded-full bg-brand-50 px-2 py-1 text-xs font-medium text-brand-700 ring-1 ring-inset ring-brand-600/20 dark:bg-brand-600/15 dark:text-brand-300">Admin</span>
                </div>
            </div>
        </Authorized>
    </AuthorizeView>

    <section class="pt-1">
        <h3 class="mb-3 text-sm font-semibold text-slate-700 dark:text-slate-200">Quick actions</h3>
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
            <a href="admin/manage-categories" class="group rounded-xl border border-slate-200/60 bg-white p-4 shadow-soft transition hover:-translate-y-0.5 hover:shadow dark:border-slate-800 dark:bg-slate-900">
                <div class="flex items-center justify-between gap-3">
                    <span class="inline-grid h-10 w-10 place-items-center rounded-lg bg-gradient-to-tr from-brand-600 to-accent-500 text-white shadow-soft">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true"><path d="M3 5h18v2H3V5zm0 6h18v2H3v-2zm0 6h18v2H3v-2z"/></svg>
                    </span>
                    <div class="min-w-0">
                        <div class="font-medium text-slate-900 group-hover:text-brand-700 dark:text-slate-100">Manage Categories</div>
                        <p class="text-xs text-slate-500">Add, edit, or hide categories.</p>
                    </div>
                    <span class="shrink-0 rounded-full bg-slate-100 px-2 py-0.5 text-xs font-medium text-slate-700 ring-1 ring-inset ring-slate-200 dark:bg-slate-800 dark:text-slate-300 dark:ring-slate-700">@_categoryCount</span>
                </div>
            </a>
            <a href="admin/manage-blog-posts" class="group rounded-xl border border-slate-200/60 bg-white p-4 shadow-soft transition hover:-translate-y-0.5 hover:shadow dark:border-slate-800 dark:bg-slate-900">
                <div class="flex items-center justify-between gap-3">
                    <span class="inline-grid h-10 w-10 place-items-center rounded-lg bg-gradient-to-tr from-brand-600 to-accent-500 text-white shadow-soft">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true"><path d="M4 4h16v2H4V4zm0 4h10v2H4V8zm0 4h10v2H4v-2zm0 4h16v2H4v-2z"/></svg>
                    </span>
                    <div class="min-w-0">
                        <div class="font-medium text-slate-900 group-hover:text-brand-700 dark:text-slate-100">Manage Blog Posts</div>
                        <p class="text-xs text-slate-500">Create and publish articles.</p>
                    </div>
                    <span class="shrink-0 rounded-full bg-slate-100 px-2 py-0.5 text-xs font-medium text-slate-700 ring-1 ring-inset ring-slate-200 dark:bg-slate-800 dark:text-slate-300 dark:ring-slate-700">@_postCount</span>
                </div>
            </a>
            <a href="admin/manage-subscribers" class="group rounded-xl border border-slate-200/60 bg-white p-4 shadow-soft transition hover:-translate-y-0.5 hover:shadow dark:border-slate-800 dark:bg-slate-900">
                <div class="flex items-center justify-between gap-3">
                    <span class="inline-grid h-10 w-10 place-items-center rounded-lg bg-gradient-to-tr from-brand-600 to-accent-500 text-white shadow-soft">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true"><path d="M16 11c1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3 1.3 3 3 3zM8 11c1.7 0 3-1.3 3-3S9.7 5 8 5 5 6.3 5 8s1.3 3 3 3zm0 2c-2.3 0-7 1.2-7 3.5V19h14v-2.5C15 14.2 10.3 13 8 13zm8 0c-.3 0-.6 0-1 .1 1.2.8 2 2.1 2 3.4V19h7v-2.5c0-2.3-4.7-3.5-8-3.5z"/></svg>
                    </span>
                    <div class="min-w-0">
                        <div class="font-medium text-slate-900 group-hover:text-brand-700 dark:text-slate-100">Manage Subscribers</div>
                        <p class="text-xs text-slate-500">View and manage your audience.</p>
                    </div>
                    <span class="shrink-0 rounded-full bg-slate-100 px-2 py-0.5 text-xs font-medium text-slate-700 ring-1 ring-inset ring-slate-200 dark:bg-slate-800 dark:text-slate-300 dark:ring-slate-700">@_subscriberCount</span>
                </div>
            </a>
        </div>
    </section>

    <section>
        <h3 class="mb-3 text-sm font-semibold text-slate-700 dark:text-slate-200">Resources</h3>
        <div class="prose max-w-none prose-slate dark:prose-invert">
            <ul>
                <li>ASP.NET Core Blazor: <a href="https://docs.microsoft.com/aspnet/core/blazor" target="_blank" rel="noopener">docs</a> and <a href="https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor" target="_blank" rel="noopener">overview</a>.</li>
                <li>Authentication and authorization: <a href="https://docs.microsoft.com/aspnet/core/security/blazor" target="_blank" rel="noopener">Blazor security</a>.</li>
                <li>SignalR realtime: <a href="https://docs.microsoft.com/aspnet/core/tutorials/signalr-blazor-webassembly" target="_blank" rel="noopener">tutorials</a>.</li>
                <li>Testing: <a href="https://docs.microsoft.com/aspnet/core/test/integration-tests" target="_blank" rel="noopener">integration tests</a>.</li>
            </ul>
        </div>
    </section>
</div>

@code {
    private int _categoryCount;
    private int _postCount;
    private int _subscriberCount;

    protected override async Task OnInitializedAsync()
    {
        var categories = await CategoryService.GetCategoriesAsync();
        _categoryCount = categories?.Length ?? 0;

        var postsPage = await BlogPostAdminService.GetBlogPostsAsync(0, 1);
        _postCount = postsPage?.TotalCount ?? 0;

        var subsPage = await SubscriberService.GetSubscribersAsync(0, 1);
        _subscriberCount = subsPage?.TotalCount ?? 0;
    }
}



