@page "/admin/manage-categories"

@attribute [Authorize(Roles = "Admin")]

@rendermode @(new InteractiveServerRenderMode(prerender: false))

<PageTitle>@Utils.GetPageTitle("Manage Categories")</PageTitle>

<AdminHeader Title="Manage Categories">
    <ActionButtons>
    <button type="button" class="inline-flex items-center rounded-md bg-brand-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-brand-700" @onclick="StartAddCategory">+ Add new Category</button>
    </ActionButtons>
</AdminHeader>

<ConfirmationModal Title="Confirm Delete"
                   Message="Are you sure you want to delete this category?"
                   IsVisible="@_showConfirmationModal"
                   ConfirmationChanged="OnModalConfirm" />

@if (this._isLoading)
{
    <Loader LoaderText="@this._loadingText" />
}

@if (this._operatingCategory is not null)
{
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-12">
        <div class="lg:col-span-6 lg:col-start-7">
            <EditForm EditContext="_editContext" OnSubmit="SaveCategoryAsync">
                <DataAnnotationsValidator />
                <div class="rounded-xl border border-slate-200/60 bg-white p-4 shadow-soft dark:border-slate-800 dark:bg-slate-900">
                    <div class="grid grid-cols-1 gap-4 lg:grid-cols-12 lg:gap-6">
                        <div class="lg:col-span-9">
                            <label class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-200">Category Name</label>
                            <InputText @bind-Value="this._operatingCategory.Name" class="w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 placeholder-slate-400 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100" placeholder="Category name" />
                            <ValidationMessage For="() => this._operatingCategory.Name" />
                            <label class="mt-3 inline-flex items-center gap-3 text-sm text-slate-700 dark:text-slate-300">
                                <span class="relative inline-flex h-5 w-9 items-center">
                                    <InputCheckbox @bind-Value="this._operatingCategory.ShowOnNavBar" class="peer sr-only" />
                                    <span class="pointer-events-none absolute inset-0 rounded-full bg-slate-300 transition-colors duration-200 ease-in-out peer-checked:bg-emerald-600"></span>
                                    <span class="pointer-events-none absolute left-0.5 top-0.5 h-4 w-4 rounded-full bg-white shadow transition-transform duration-200 ease-in-out peer-checked:translate-x-4"></span>
                                </span>
                                Show on Navbar
                            </label>
                        </div>
                        <div class="lg:col-span-3 flex flex-col justify-start gap-2">
                            <button type="submit" class="inline-flex items-center justify-center rounded-md bg-emerald-600 px-3 py-2 text-sm font-medium text-white hover:bg-emerald-700">Save</button>
                            <button type="button" class="inline-flex items-center justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-medium text-white hover:bg-red-700" @onclick="() => CancelEdit()">Cancel</button>
                        </div>
                    </div>
                </div>
            </EditForm>
        </div>
    </div>
}

<div class="mt-6 overflow-hidden rounded-xl border border-slate-200/60 bg-white shadow-soft dark:border-slate-800 dark:bg-slate-900">
<QuickGrid Items="@_categories" class="w-full text-left text-sm divide-y divide-slate-200 dark:divide-slate-800 [&_thead_th]:bg-slate-50 dark:[&_thead_th]:bg-slate-800 [&_thead_th]:text-slate-700 dark:[&_thead_th]:text-slate-200 [&_th]:px-3 [&_td]:px-3 [&_th]:py-2 [&_td]:py-2 [&_tbody_tr:nth-child(odd)]:bg-slate-50 dark:[&_tbody_tr:nth-child(odd)]:bg-slate-800/40">
    <PropertyColumn Property="@(c => c.Id)" Align="Align.Center" />
    <PropertyColumn Property="@(c => c.Name)" Align="Align.Center" />
    <PropertyColumn Property="@(c => c.Slug)" Align="Align.Center" />
    <TemplateColumn Title="Show on Navbar" Align="Align.Center">
        <div class="inline-flex items-center gap-2">
            <label class="relative inline-flex h-5 w-9 cursor-pointer items-center">
                <input type="checkbox" role="switch" aria-checked="@context.ShowOnNavBar" aria-busy="@_savingToggles.Contains(context.Id)" disabled="@_savingToggles.Contains(context.Id)" @bind="context.ShowOnNavBar" @bind:after="(() => HandleShowOnNavBarChanged(context))" class="peer sr-only" />
                <span class="pointer-events-none absolute inset-0 rounded-full bg-slate-300 transition-colors duration-200 ease-in-out peer-checked:bg-emerald-600"></span>
                <span class="pointer-events-none absolute left-0.5 top-0.5 h-4 w-4 rounded-full bg-white shadow transition-transform duration-200 ease-in-out peer-checked:translate-x-4"></span>
            </label>
            <span class="inline-block h-4 w-4">
                @if (_savingToggles.Contains(context.Id))
                {
                    <svg class="h-4 w-4 animate-spin text-slate-500" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z" />
                    </svg>
                }
            </span>
        </div>
    </TemplateColumn>
    <TemplateColumn Title="Actions" Align="Align.Center">
        <button type="button" class="mr-2 inline-flex items-center rounded-md bg-brand-600 px-3 py-1 text-xs font-medium text-white hover:bg-brand-700" @onclick="() => HandleEditCategory(context)">Edit</button>
        <button type="button" class="inline-flex items-center rounded-md bg-red-600 px-3 py-1 text-xs font-medium text-white hover:bg-red-700" @onclick="() => ConfirmDeleteCategory(context)">Delete</button>
    </TemplateColumn>
</QuickGrid>
</div>
<div class="mt-4">
    <Paginator State="_paginationState" />
</div>
